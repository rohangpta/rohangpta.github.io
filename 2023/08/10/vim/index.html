<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Ronalds Vilcins - https://grohan.co"><title>Factorials & Fun with Vim | Rohan Gupta</title><meta name=description content="Vim trix and more"><meta name=twitter:card content="summary"><meta name=twitter:title content="Factorials & Fun with Vim"><meta name=twitter:description content="Vim trix and more"><meta property="og:title" content="Factorials & Fun with Vim"><meta property="og:description" content="Vim trix and more"><meta property="og:type" content="article"><meta property="og:url" content="https://grohan.co/2023/08/10/vim/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-10T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-10T00:00:00+00:00"><meta itemprop=name content="Factorials & Fun with Vim"><meta itemprop=description content="Vim trix and more"><meta itemprop=datePublished content="2023-08-10T00:00:00+00:00"><meta itemprop=dateModified content="2023-08-10T00:00:00+00:00"><meta itemprop=wordCount content="1246"><meta itemprop=keywords content="programming,"><link rel=canonical href=https://grohan.co/2023/08/10/vim/><link rel=dns-prefetch href=https://www.google-analytics.com><link href=https://www.google-analytics.com rel=preconnect crossorigin><link rel=alternate type=application/atom+xml title="Rohan Gupta" href=https://grohan.coatom.xml><link rel=alternate type=application/json title="Rohan Gupta" href=https://grohan.cofeed.json><link rel="shortcut icon" type=image/png href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII="><style>*,:after,:before{box-sizing:border-box;padding:0}body{font:1rem/1.5 Verdana,-apple-system,BlinkMacSystemFont,avenir next,avenir,helvetica,helvetica neue,ubuntu,roboto,noto,segoe ui,arial,sans-serif;text-rendering:optimizeSpeed}.posts hr{margin-top:0;margin-bottom:0;margin-right:.5rem;margin-left:.5rem;height:1px;border:none;border-bottom:1px #353535;flex:1 0 1rem}main{max-width:70ch;padding:2ch;margin:auto}a,body{color:#353535}::selection,a:focus,a:hover{background-color:#f0f0f0;color:#000}.meta{margin:0 0 2.5rem}.tags::before{content:"\2022";margin-left:1rem}code,pre{color:#353535;font-family:San Francisco Mono,Monaco,consolas,lucida console,dejavu sans mono,bitstream vera sans mono,monospace;font-size:normal;border:1px solid #353535;font-size:small}code{padding:.1rem;border:none}pre{padding:.5rem;overflow-x:auto}pre code{border:none}img{max-width:100%;border:1px solid #353535}hr{background:#353535;height:1px;border:0}ul{list-style-type:square}ul,ol{padding-left:1.2rem}header li,footer li{display:inline;text-transform:uppercase}header a,footer a{text-decoration:none}header ul,footer ul{justify-content:space-between;display:flex}[aria-current=page]{text-decoration:line-through}header,section,footer{padding:1rem 0}blockquote{border-left:5px solid #353535;padding-left:1rem}.posts ul,header ul,footer ul{list-style:none}.posts,header ul,footer ul{padding:0}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.7rem}.posts li a,.posts li div{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}.hash{opacity:.25;text-decoration:none}table{border-collapse:collapse;text-align:left;width:100%}table tr{background:#fff;border-bottom:1px solid}table th,table td{padding:10px 20px}</style><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Factorials \u0026 Fun with Vim","headline":"Factorials \u0026 Fun with Vim","alternativeHeadline":"","description":"Vim trix and more","inLanguage":"en","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/grohan.co\/2023\/08\/10\/vim\/"},"author":{"@type":"Person","name":"Rohan Gupta"},"creator":{"@type":"Person","name":"Rohan Gupta"},"accountablePerson":{"@type":"Person","name":"Rohan Gupta"},"copyrightHolder":"Rohan Gupta","copyrightYear":"2023","dateCreated":"2023-08-10T00:00:00.00Z","datePublished":"2023-08-10T00:00:00.00Z","dateModified":"2023-08-10T00:00:00.00Z","publisher":{"@type":"Organization","name":"Rohan Gupta","url":"https://grohan.co","logo":{"@type":"ImageObject","url":"https:\/\/grohan.co\/images\/rohan.jpg","width":"32","height":"32"}},"image":"https://grohan.co/images/rohan.jpg","url":"https:\/\/grohan.co\/2023\/08\/10\/vim\/","wordCount":"1246","genre":["programming"],"keywords":["programming"]}</script></head><body><main><header><nav><ul><li><a href=/posts aria-current=page>Writing</a></li><li><a href=/about>About</a></li><li><a href=/projects>Projects</a></li></ul></nav></header><hr><section><h2 itemprop="name headline">Factorials & Fun with Vim</h2><p class=meta><time itemprop=datePublished datetime=2023-08-10>August 10, 2023</time> &bull;
<a href=/tags/programming>programming</a></p><span itemprop=articleBody><p>I recently hit a somewhat important milestone in my life: one year as a Vim
user. Despite its steep learning curve, I used to think that mastering Vim
was mostly about habit formation. I swore by the
cheatsheets and believed I would be golden. After all, a
text editor couldn&rsquo;t be too terribly complex, right?</p><p>However, I soon realised how <em>little</em> I knew about Vim and how much there
really was to know! In writing this post, I&rsquo;d like to demonstrate (by
way of example) some of
the features of Vim that I found interesting; this is by no means a
comprehensive guide to Vim&rsquo;s capabilities (I would be lying if I said I knew half of what Vim
has to offer), but perhaps a newfound <a href=https://xkcd.com/378/>taste of power</a>
for the green, fresh-off-VS Code individual looking to dabble with the dark arts.</p><h1 id=computing-factorials>Computing Factorials <a href=#computing-factorials class=hash>#</a></h1><p>This post has a simple goal: computing the factorial. A classic exercise for any
new programmer &ndash; simple to understand, but broad in terms of concepts covered.
More formally, we&rsquo;ll define our problem as writing a Vim routine that takes an input (ex. 5!) and spits out the factorial (120 in our example).</p><p>As a preface, I&rsquo;ll be referencing a variety of Vim features in this post, but I&rsquo;m explicitly choosing not to explain their usage in detail. Instead, I&rsquo;ve tried to link resources that explain syntax and functionality better than I can. This is not a tutorial as much as it is a showcase.</p><h2 id=state-transitions-and-math>State Transitions and Math <a href=#state-transitions-and-math class=hash>#</a></h2><p>To break our problem down a bit, we need a way to multiply (and decrement) numbers in Vim, store the results somewhere, and then repeat that process N times. Sounds simple enough?</p><p>Thankfully, we don&rsquo;t have to implement multiplication from scratch. Vim&rsquo;s got us covered here with the <a href=https://stackoverflow.com/questions/7027741/what-is-the-purpose-of-the-expression-register>expression register</a>, noted by &ldquo;=&rdquo;. You can access this in insert mode using <code>&lt;C-r>=</code> and enter any expression you&rsquo;d like. The expression register is clever enough to do basic math operations (addition, subtraction, multiplication, division), but not the factorial &ndash; unfortunately
our life isn&rsquo;t <em>that</em> easy.</p><p>As an example, you could enter insert mode and input <code>&lt;C-r>=10*7</code> and the text under your cursor will be filled with 70, neat enough for simple calculations on the fly.</p><p>So we&rsquo;ve got a way to multiply numbers, now we need to do this recursively as
well as store intermediate state somewhere. Let&rsquo;s tackle the state problem
first; for the sake of demonstration, we&rsquo;ll do the most naive thing I can think
of to store our intermediate state: write to text.</p><p>Consider a program with the following states</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>7!
</span></span><span style=display:flex><span>6!7
</span></span><span style=display:flex><span>5!42
</span></span><span style=display:flex><span>4!210
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>5040
</span></span></code></pre></div><p>The contents after the ! store the intermediate state of the program, while leaving the contents before valid for recursion. We now effectively have program memory equal to the size of the text buffer we&rsquo;re working with!</p><p>With our states defined, we&rsquo;ve now got to think about how exactly we transition between these states. This is where we can introduce the Vim <a href=https://vim.fandom.com/wiki/Search_and_replace>substitute</a> command, which matches against patterns and replaces them according to a set of rules.</p><p>The command below matches on a number <code>a</code> followed by ! and replaces it with <code>(a-1)!a</code>. This is our base case for the recursion. We use the <code>.</code> operator to concatenate our expressions (using the expression register) together. We&rsquo;re also able to use <code>submatch(0)</code> which simply matches against everything captured.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>:s/\d\+!/\=submatch(0) - 1 . &#34;!&#34; . submatch(0)/
</span></span></code></pre></div><p>Next, we need our &ldquo;recursive case&rdquo;, matching on <code>a!b</code> and replacing with <code>a-1!b*a</code>. Note the introduction of capturing groups below! Previously, we only matched on one set of characters but now we have 2 distinct operations, which is also why we use indices 1 and 2 for <code>submatch</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>:s/\(\d\+\)!\(\d\+\)/\=submatch(1) - 1 . &#34;!&#34; . submatch(1) \* submatch(2)/
</span></span></code></pre></div><p>Fantastic! This will take 6!7 and map it to 5!42, and so on.</p><h2 id=orchestration>Orchestration <a href=#orchestration class=hash>#</a></h2><p>We&rsquo;ve got all the state transformations we need now, but we still need a way to somehow orchestrate them together in a single command. This includes finding a way to programmatically recurse on our substitution expression a variable number of times. Sounds like a lot, but Vim&rsquo;s again got us covered with an idiomatic tool: <a href=https://vim.fandom.com/wiki/Macros>the macro</a>, which is essentially a way to record sequences of edits and apply them in one shot.</p><p>Our script now looks like this (we record the macro in the <code>@b</code> register):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>V
</span></span><span style=display:flex><span>:s/\d\+!/\=submatch(0) - 1 . &#34;!&#34; . submatch(0)/
</span></span><span style=display:flex><span>qb
</span></span><span style=display:flex><span>V
</span></span><span style=display:flex><span>:s/\(\d\+\)!\(\d\+\)/\=submatch(1) - 1 . &#34;!&#34; . submatch(1) \* submatch(2)/
</span></span><span style=display:flex><span>q
</span></span></code></pre></div><p>Nearly done, now all we need is a way to find the number of times to execute the macro. Until now, we&rsquo;ve been on a purist edit-only streak, but let&rsquo;s instead introduce some <em>real</em> programming concepts (variables!?).</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>let i = matchstr(getline(&#39;.&#39;), &#39;\d\+&#39;)
</span></span><span style=display:flex><span>execute &#34;normal! &#34; . i . &#34;@b&#34;
</span></span></code></pre></div><p>These two lines will execute our macro <code>i</code> times, where <code>i</code> is simply the value of the number we want to compute the factorial of.</p><p>Finally, this will leave us with 1!5040 (in the case of 7!). We need to perform just a bit of cleanup, since we have some extra information in the line (corresponding to our state), which we can do with the following substitution logic:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>:s/.\*!\(\d\+\)/\1/
</span></span></code></pre></div><p>or alternatively, using <a href=https://vim.fandom.com/wiki/Power_of_g>globals</a> (note the use of the Vim exclusive look-ahead <code>\ze</code>)</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>:g/.\*!\ze/normal! df!
</span></span></code></pre></div><p>And that&rsquo;s it! Combining all of these expressions together gives us a general factorial machine.</p><p><strong>Note</strong>: I&rsquo;m certainly aware of neater/shorter/better ways to do the same thing
but I wanted to go through as many different &ldquo;Vim trix&rdquo; as I could in a post. If
you&rsquo;re looking to optimise for neatness and flex your Vim muscles, you might want to check out <a href=https://vimgolf.com>Vim Golf</a>. I&rsquo;m convinced some of the folks on there are not human.</p><h2 id=means-to-an-end>Means to an End <a href=#means-to-an-end class=hash>#</a></h2><p>The purpose of this post is not to encourage the reader to leave
their trusted calculator behind in favour of Vim, but instead to view a
multi-stage programming problem under the lens of powerful, expressive edits.</p><p>Vim, like many other programming tools, is primarily a means to an end. It
simply happens to be powerful enough to do almost anything under the sun (if you are determined and/or
crazy enough).</p><p>What&rsquo;s also remarkable to me is how Vim (circa 1991) has squarely stood its ground in the everchanging landscape of software development tools. Perhaps this is a testament to the timeless quality of design
decisions made &ndash; a seemingly rare feat in the fast-paced modern world of
software. There&rsquo;s a long way to go before I consider myself an expert at Vim, and I&rsquo;m not
sure if there truly is an end in sight; but perhaps that&rsquo;s what makes it a fun
tool to use?</p><p><em>P.S.</em>: I write fondly about Vim but I should mention that I&rsquo;m actually
an Emacs user. Plot twist, I know. My editor of choice is <a href=https://github.com/doomemacs/doomemacs>Doom Emacs</a> which
is a smooth, Space-centric Emacs config with Vim emulation. Why fight over
Emacs vs Vim when you can have both?</p><h2 id=further-reading>Further Reading <a href=#further-reading class=hash>#</a></h2><p>I realise as I write this post that a lot of what I&rsquo;ve written about involves Vim regex.
Here&rsquo;s an <a href=https://dev.to/iggredible/learning-vim-regex-26ep>article</a> I found
online that does a good job explaining it.</p><p>I&rsquo;m often reminded of <a href=https://stackoverflow.com/questions/1218390/what-is-your-most-productive-shortcut-with-vim/1220118#1220118>this legendary
answer</a>
which captures the essence of what I think makes Vim so enduringly good:
powerful expressivity combined with a simplistic grammar.</p><p>Lastly, here is a <a href=https://j11g.com/2023/08/07/the-legacy-of-bram-moolenaar/>well-written epitaph</a> to Bram Moolenar (the creator of Vim).</p></span></section><hr><footer><nav><ul><li>© 2023</li></ul></nav></footer></main></body></html>